# ParkBoard - Comprehensive Test Suite
**Generated:** 2025-10-07 09:07:52
**Purpose:** Exhaustive manual and unit tests for all routes, features, and user flows

---

## Table of Contents

1. [Test Overview & Strategy](#test-overview--strategy)
2. [Route/URL Tests](#routeurl-tests)
3. [Database/SQL Tests](#databasesql-tests)
4. [Authentication Flow Tests](#authentication-flow-tests)
5. [User Flow Tests](#user-flow-tests)
6. [Component Unit Tests](#component-unit-tests)
7. [Integration Tests](#integration-tests)
8. [Performance Tests](#performance-tests)
9. [Security Tests](#security-tests)
10. [Test Execution Checklist](#test-execution-checklist)

---

## Test Overview & Strategy

### Test Pyramid

```
        /\
       /  \  E2E Tests (5%)
      /____\
     /      \  Integration Tests (15%)
    /________\
   /          \  Unit Tests (80%)
  /__________  \
```

### Priority Levels

- **ðŸ”´ P0 (Critical)** - Blocks MVP launch, must pass before any deployment
- **ðŸŸ¡ P1 (High)** - Core functionality, must pass before production
- **ðŸŸ¢ P2 (Medium)** - Important but not blocking, fix within 1 week
- **ðŸ”µ P3 (Low)** - Nice-to-have, fix when convenient

### Test Coverage Goals

| Area | Target Coverage | Current Status |
|------|----------------|----------------|
| Critical Paths | 100% | âš ï¸ 0% |
| API Routes | 90% | âš ï¸ 0% |
| Components | 80% | âš ï¸ 0% |
| Utils | 90% | âš ï¸ 0% |
| E2E Flows | 100% of P0/P1 | âš ï¸ 0% |

---

## Route/URL Tests

### ðŸ”´ P0 - Critical Routes (Must Work)

#### TEST-R001: Landing Page
**Route:** `/`
**Source File:** `app/page.tsx`
**Config:** `app/layout.tsx`

**Manual Test Steps:**
1. Navigate to `http://localhost:3000/`
2. Verify page loads without errors
3. Verify "ParkBoard" heading displays
4. Verify "Rent parking slots in your condo" text displays
5. Click "Browse Slots" button
   - **Expected:** Navigate to `/slots`
6. Navigate back to `/`
7. Click "List Your Slot" button
   - **Expected:** Navigate to `/slots/new`
8. Navigate back to `/`
9. Click "Login" link
   - **Expected:** Navigate to `/login`
10. Navigate back to `/`
11. Click "Sign Up" link
    - **Expected:** Navigate to `/login?mode=signup`

**Automated Test:**
```typescript
// __tests__/routes/landing.test.tsx
import { render, screen } from '@testing-library/react'
import Home from '@/app/page'

describe('Landing Page', () => {
  it('renders heading', () => {
    render(<Home />)
    expect(screen.getByText('ParkBoard')).toBeInTheDocument()
  })

  it('renders CTA buttons', () => {
    render(<Home />)
    expect(screen.getByText('Browse Slots')).toBeInTheDocument()
    expect(screen.getByText('List Your Slot')).toBeInTheDocument()
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 5 minutes manual, 30 minutes automated

---

#### TEST-R002: Login Page
**Route:** `/login`
**Source File:** `app/(auth)/login/page.tsx`
**Dependencies:** `lib/supabase/client.ts`, `components/auth/AuthWrapper.tsx`

**Manual Test Steps:**

**Happy Path:**
1. Navigate to `/login`
2. Verify login form displays with:
   - Email input field
   - Password input field
   - Submit button
3. Enter valid credentials:
   - Email: `test@parkboard.com`
   - Password: `TestPassword123!`
4. Click "Login" button
5. **Expected:**
   - No error message
   - Redirect to `/slots`
   - User sees navigation with their name

**Error Cases:**
6. Navigate back to `/login`
7. Enter invalid email: `notanemail`
8. Click "Login"
   - **Expected:** Email validation error
9. Clear form
10. Enter valid email but wrong password: `test@parkboard.com` / `WrongPass`
11. Click "Login"
    - **Expected:** "Invalid credentials" error message
12. Clear form
13. Leave fields empty
14. Click "Login"
    - **Expected:** Required field validation errors

**Edge Cases:**
15. Enter email with spaces: ` test@parkboard.com `
    - **Expected:** Trimmed and accepted
16. Enter password with special characters: `P@$$w0rd!#`
    - **Expected:** Accepted (no sanitization)

**Automated Test:**
```typescript
// __tests__/routes/login.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react'
import LoginPage from '@/app/(auth)/login/page'

jest.mock('@/lib/supabase/client', () => ({
  createClient: () => ({
    auth: {
      signInWithPassword: jest.fn()
    }
  })
}))

describe('Login Page', () => {
  it('renders login form', () => {
    render(<LoginPage />)
    expect(screen.getByLabelText(/email/i)).toBeInTheDocument()
    expect(screen.getByLabelText(/password/i)).toBeInTheDocument()
    expect(screen.getByRole('button', { name: /login/i })).toBeInTheDocument()
  })

  it('shows error on invalid credentials', async () => {
    const mockSignIn = jest.fn().mockResolvedValue({ error: { message: 'Invalid credentials' } })
    // ... test implementation
  })

  it('redirects on successful login', async () => {
    const mockSignIn = jest.fn().mockResolvedValue({ data: { user: {} }, error: null })
    // ... test implementation
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 15 minutes manual, 1 hour automated

---

#### TEST-R003: Register Page
**Route:** `/register` or `/login?mode=signup`
**Source File:** `app/(auth)/register/page.tsx`
**Dependencies:** `lib/supabase/client.ts`, `app/api/profiles/route.ts`

**Manual Test Steps:**

**Happy Path:**
1. Navigate to `/register`
2. Verify registration form displays with:
   - Name input
   - Email input
   - Password input
   - Phone input
   - Unit Number input
   - Submit button
3. Enter valid data:
   - Name: `John Doe`
   - Email: `john.doe@parkboard.com`
   - Password: `SecurePass123!`
   - Phone: `+639171234567`
   - Unit Number: `10A`
4. Click "Sign Up"
5. **Expected:**
   - Account created in `auth.users`
   - Profile created in `user_profiles`
   - Redirect to `/slots`
   - User logged in automatically

**Validation Tests:**
6. Test invalid phone formats:
   - `12345` â†’ **Expected:** Invalid phone error
   - `09171234567` â†’ **Expected:** Accept (valid PH format)
   - `+639171234567` â†’ **Expected:** Accept (valid international)
7. Test duplicate email:
   - Use existing email from step 3
   - **Expected:** "Email already exists" error
8. Test duplicate unit number:
   - Use existing unit from step 3
   - **Expected:** "Unit number already registered" error
9. Test password strength:
   - `pass` â†’ **Expected:** "Password too weak" error
   - `Password123` â†’ **Expected:** Accept
10. Test required fields:
    - Submit with empty name â†’ **Expected:** Required field error
    - Submit with empty email â†’ **Expected:** Required field error

**Automated Test:**
```typescript
// __tests__/routes/register.test.tsx
describe('Register Page', () => {
  it('validates phone number format', () => {
    // Test Philippine phone formats
    expect(validatePhone('09171234567')).toBe(true)
    expect(validatePhone('+639171234567')).toBe(true)
    expect(validatePhone('12345')).toBe(false)
  })

  it('creates user profile after signup', async () => {
    const mockSignUp = jest.fn()
    const mockProfileCreate = jest.fn()
    // ... test implementation
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 20 minutes manual, 1.5 hours automated

---

#### TEST-R004: Browse Slots Page
**Route:** `/slots`
**Source File:** `app/(marketplace)/slots/page.tsx`
**Database:** `parking_slots`, `user_profiles`
**SQL Schema:** `db/schema_refined.sql` lines 38-58

**Manual Test Steps:**

**Setup:** Create test data in database
```sql
-- Run in Supabase SQL Editor
INSERT INTO parking_slots (owner_id, slot_number, slot_type, price_per_hour, description, status)
VALUES
  ((SELECT id FROM user_profiles LIMIT 1), 'A-10', 'covered', 50.00, 'Near elevator', 'active'),
  ((SELECT id FROM user_profiles LIMIT 1), 'B-05', 'covered', 45.00, 'Corner slot', 'active'),
  ((SELECT id FROM user_profiles LIMIT 1), 'C-12', 'uncovered', 30.00, 'Open air', 'active');
```

**Test Execution:**
1. Navigate to `/slots` (must be logged in)
2. **Expected:** AuthWrapper redirects if not logged in
3. Log in as test user
4. Navigate to `/slots`
5. Verify page displays:
   - Navigation bar
   - "Available Parking Slots" heading
   - Grid of slot cards
6. Verify each slot card shows:
   - Slot number (e.g., "Slot A-10")
   - Slot type (e.g., "covered")
   - Price per hour (e.g., "â‚±50/hr")
   - Description
   - Owner name
7. Count displayed slots â†’ **Expected:** 3 slots
8. Click on first slot card
   - **Expected:** Navigate to `/slots/{slot_id}`

**Empty State Test:**
9. Delete all slots from database
```sql
DELETE FROM bookings; -- Must delete bookings first (foreign key)
DELETE FROM parking_slots;
```
10. Refresh `/slots`
11. **Expected:** "No slots available. Be the first to list one!" message
12. Verify "List Your Slot" button displays
13. Click button â†’ **Expected:** Navigate to `/slots/new`

**Filter/Search Test (TODO - not implemented):**
14. Create 20 test slots
15. Verify pagination or infinite scroll works
16. Test search by slot number

**Automated Test:**
```typescript
// __tests__/routes/slots.test.tsx
import { render, screen, waitFor } from '@testing-library/react'
import SlotsPage from '@/app/(marketplace)/slots/page'

jest.mock('@/lib/supabase/client', () => ({
  createClient: () => ({
    from: jest.fn(() => ({
      select: jest.fn(() => ({
        eq: jest.fn(() => ({
          data: [
            { slot_id: 1, slot_number: 'A-10', price_per_hour: 50, user_profiles: { name: 'John' } }
          ],
          error: null
        }))
      }))
    }))
  })
}))

describe('Browse Slots Page', () => {
  it('displays slot cards', async () => {
    render(<SlotsPage />)
    await waitFor(() => {
      expect(screen.getByText('Slot A-10')).toBeInTheDocument()
      expect(screen.getByText('â‚±50/hr')).toBeInTheDocument()
    })
  })

  it('shows empty state when no slots', async () => {
    // Mock empty data
    // ... test implementation
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 15 minutes manual, 2 hours automated
**Related Tests:** TEST-D001 (Database), TEST-UF001 (User Flow)

---

#### TEST-R005: Slot Detail & Booking Page
**Route:** `/slots/[slotId]`
**Source File:** `app/(marketplace)/slots/[slotId]/page.tsx`
**Database:** `parking_slots`, `bookings`, `user_profiles`

**Manual Test Steps:**

**Setup:**
```sql
-- Get a test slot ID
SELECT slot_id, slot_number FROM parking_slots WHERE status = 'active' LIMIT 1;
-- Example result: slot_id = 1, slot_number = 'A-10'
```

**Test Execution:**
1. Navigate to `/slots/1` (replace with actual slot_id)
2. Verify page displays:
   - Navigation bar
   - "Book Parking Slot" heading
   - Slot details card (read-only):
     - Slot number
     - Slot type
     - Price per hour
     - Description
     - Owner name
     - Owner phone
   - Booking form:
     - Start time input (datetime-local)
     - End time input (datetime-local)
     - Submit button

**Happy Path - Create Booking:**
3. Enter start time: Tomorrow at 9:00 AM
4. Enter end time: Tomorrow at 5:00 PM
5. **Expected:** Live price calculation displays
   - 8 hours Ã— â‚±50/hr = â‚±400
6. Click "Confirm Booking"
7. **Expected:**
   - Success message displays
   - Redirect to `/bookings` after 2 seconds
8. Verify booking appears in database:
```sql
SELECT * FROM bookings WHERE slot_id = 1 ORDER BY created_at DESC LIMIT 1;
```

**Validation Tests:**
9. Navigate back to `/slots/1`
10. Enter end time BEFORE start time
    - Start: Tomorrow 5:00 PM
    - End: Tomorrow 9:00 AM
11. Click "Confirm Booking"
    - **Expected:** "End time must be after start time" error
12. Enter start time in the past
    - Start: Yesterday 9:00 AM
13. Click "Confirm Booking"
    - **Expected:** "Start time must be in the future" error

**Overlap Test:**
14. Create conflicting booking in database:
```sql
-- Assuming tomorrow = 2025-10-08
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (
  1,
  (SELECT id FROM user_profiles LIMIT 1),
  '2025-10-08 10:00:00+00',
  '2025-10-08 14:00:00+00',
  200.00,
  'confirmed'
);
```
15. Try to book overlapping time:
    - Start: Tomorrow 9:00 AM
    - End: Tomorrow 11:00 AM (overlaps with 10:00-14:00)
16. Click "Confirm Booking"
    - **Expected:** "Slot already booked for this time" error

**Price Calculation Tests:**
17. Test various duration calculations:
    - 1 hour â†’ â‚±50
    - 2.5 hours â†’ â‚±125
    - 24 hours â†’ â‚±1,200
18. Verify price updates live as dates change

**Invalid Slot Test:**
19. Navigate to `/slots/99999` (non-existent ID)
    - **Expected:** "Slot not found" error
    - "Back to Slots" button displays

**Automated Test:**
```typescript
// __tests__/routes/slot-detail.test.tsx
describe('Slot Detail Page', () => {
  it('calculates price correctly', () => {
    const start = new Date('2025-10-08T09:00:00')
    const end = new Date('2025-10-08T17:00:00')
    const pricePerHour = 50

    const hours = (end - start) / (1000 * 60 * 60)
    const total = hours * pricePerHour

    expect(total).toBe(400)
  })

  it('validates time range', () => {
    const start = new Date('2025-10-08T17:00:00')
    const end = new Date('2025-10-08T09:00:00')

    expect(end > start).toBe(false)
    // Should show error
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 25 minutes manual, 3 hours automated
**Related Tests:** TEST-D002 (Database Constraints), TEST-UF002 (Booking Flow)

---

#### TEST-R006: My Bookings Page
**Route:** `/bookings`
**Source File:** `app/(marketplace)/bookings/page.tsx`
**Database:** `bookings`, `parking_slots`, `user_profiles`

**Manual Test Steps:**

**Setup:**
```sql
-- Create test bookings for logged-in user
-- Get current user ID from Supabase Auth
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES
  (1, 'YOUR_USER_ID', NOW() + INTERVAL '1 day', NOW() + INTERVAL '1 day 8 hours', 400.00, 'pending'),
  (2, 'YOUR_USER_ID', NOW() + INTERVAL '2 days', NOW() + INTERVAL '2 days 4 hours', 200.00, 'confirmed'),
  (3, 'YOUR_USER_ID', NOW() - INTERVAL '1 day', NOW() - INTERVAL '1 day' + INTERVAL '2 hours', 100.00, 'completed');
```

**Test Execution:**
1. Navigate to `/bookings` (must be logged in)
2. Verify page displays:
   - Navigation bar
   - "My Bookings" heading
   - List of booking cards (3 bookings from setup)
3. Verify each booking card shows:
   - Booking ID
   - Slot number
   - Start time (formatted: "Oct 8, 2025, 9:00 AM")
   - End time
   - Total price (formatted: "â‚±400.00")
   - Status badge:
     - Pending â†’ Yellow badge
     - Confirmed â†’ Green badge
     - Completed â†’ Blue badge
     - Cancelled â†’ Red badge
   - Owner contact info (name, phone)
4. Verify bookings sorted by created_at DESC (newest first)

**Cancel Booking Test:**
5. Find booking with status = 'pending'
6. Verify "Cancel Booking" button displays
7. Click "Cancel Booking"
8. **Expected:** Browser confirm dialog: "Are you sure?"
9. Click "Cancel" in dialog
   - **Expected:** No change, booking still pending
10. Click "Cancel Booking" again
11. Click "OK" in dialog
    - **Expected:**
      - Status badge changes to "CANCELLED" (red)
      - "Cancel Booking" button disappears
12. Verify in database:
```sql
SELECT status FROM bookings WHERE booking_id = [the_booking_id];
-- Expected: 'cancelled'
```

**Confirmed Booking Test:**
13. Find booking with status = 'confirmed'
14. **Expected:** No "Cancel Booking" button (can't cancel confirmed)

**Empty State Test:**
15. Delete all bookings for current user
```sql
DELETE FROM bookings WHERE renter_id = 'YOUR_USER_ID';
```
16. Refresh `/bookings`
17. **Expected:**
    - "You haven't made any bookings yet." message
    - "Browse Available Slots" button
18. Click button â†’ Navigate to `/slots`

**Automated Test:**
```typescript
// __tests__/routes/bookings.test.tsx
describe('My Bookings Page', () => {
  it('displays booking list', async () => {
    // Mock Supabase to return bookings
    const mockBookings = [
      { booking_id: 1, status: 'pending', total_price: 400, parking_slots: { slot_number: 'A-10' } }
    ]
    // ... test implementation
  })

  it('cancels booking on confirm', async () => {
    // Test cancel flow
  })

  it('shows empty state', async () => {
    // Mock empty bookings
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 20 minutes manual, 2 hours automated

---

#### TEST-R007: New Slot Listing Page
**Route:** `/slots/new`
**Source File:** `app/(marketplace)/slots/new/page.tsx`
**Database:** `parking_slots`

**Manual Test Steps:**

**Happy Path:**
1. Navigate to `/slots/new` (must be logged in)
2. Verify form displays:
   - Slot Number input (required)
   - Slot Type dropdown (covered/uncovered/tandem)
   - Description textarea
   - Price per Hour input (required)
   - Note about contact info
   - "List Slot" button
   - "Cancel" button
3. Fill form:
   - Slot Number: `TEST-99`
   - Slot Type: `covered`
   - Description: `Test slot near elevator`
   - Price: `50.00`
4. Click "List Slot"
5. **Expected:**
   - Loading state ("Listing...")
   - Success (no error)
   - Redirect to `/slots`
6. Verify slot appears in slots list
7. Verify in database:
```sql
SELECT * FROM parking_slots WHERE slot_number = 'TEST-99';
-- Expected: 1 row, owner_id = current user, status = 'active'
```

**Validation Tests:**
8. Navigate to `/slots/new`
9. Submit with empty slot number
   - **Expected:** "Slot number is required" error
10. Submit with price = 0
    - **Expected:** "Price must be greater than 0" error
11. Submit with price = -10
    - **Expected:** "Price must be greater than 0" error
12. Submit with slot number = `TEST-99` (duplicate)
    - **Expected:** "This slot number already exists" error

**Edge Cases:**
13. Enter slot number with spaces: ` a-10 `
    - **Expected:** Trimmed and uppercased to `A-10`
14. Enter very long description (>1000 chars)
    - **Expected:** Accepted (no limit in schema)
15. Click "Cancel" button
    - **Expected:** Navigate to `/slots`

**Automated Test:**
```typescript
// __tests__/routes/new-slot.test.tsx
describe('New Slot Page', () => {
  it('validates required fields', async () => {
    // Test form validation
  })

  it('creates slot successfully', async () => {
    const mockInsert = jest.fn().mockResolvedValue({ data: {}, error: null })
    // ... test implementation
  })

  it('handles duplicate slot number', async () => {
    const mockInsert = jest.fn().mockResolvedValue({
      error: { code: '23505', message: 'unique constraint violation' }
    })
    // ... test implementation
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 15 minutes manual, 1.5 hours automated

---

### ðŸŸ¡ P1 - High Priority Routes

#### TEST-R008: Profile API Endpoint
**Route:** `POST /api/profiles`
**Source File:** `app/api/profiles/route.ts`
**Database:** `user_profiles`

**Manual Test Steps:**

**Happy Path:**
```bash
curl -X POST http://localhost:3000/api/profiles \
  -H "Content-Type: application/json" \
  -d '{
    "id": "00000000-0000-0000-0000-000000000000",
    "name": "Test User",
    "email": "test@example.com",
    "phone": "+639171234567",
    "unit_number": "10A"
  }'
```
- **Expected:** `{ "success": true }`

**Validation Tests:**

1. Missing required fields:
```bash
curl -X POST http://localhost:3000/api/profiles \
  -d '{"name": "Test"}'
```
- **Expected:** `{ "error": "Missing required fields" }` (400)

2. Invalid phone format:
```bash
curl -X POST http://localhost:3000/api/profiles \
  -d '{
    "id": "...",
    "name": "Test",
    "phone": "12345",
    "unit_number": "10A",
    "email": "test@example.com"
  }'
```
- **Expected:** `{ "error": "Invalid phone number format" }` (400)

3. Duplicate unit number:
```bash
# Run twice with same unit_number
```
- **Expected:** `{ "error": "Unit number is already registered" }` (409)

**Automated Test:**
```typescript
// __tests__/api/profiles.test.ts
import { POST } from '@/app/api/profiles/route'

describe('POST /api/profiles', () => {
  it('validates phone format', async () => {
    const request = new Request('http://localhost/api/profiles', {
      method: 'POST',
      body: JSON.stringify({ phone: '12345' })
    })
    const response = await POST(request)
    expect(response.status).toBe(400)
  })
})
```

**Priority:** ðŸŸ¡ P1
**Estimated Time:** 15 minutes manual, 1 hour automated

---

## Database/SQL Tests

### ðŸ”´ P0 - Critical Database Tests

#### TEST-D001: Schema Creation
**Source File:** `db/schema_refined.sql`

**Manual Test Steps:**

1. Run schema in Supabase SQL Editor (lines 1-287)
2. Verify tables created:
```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```
- **Expected:** `bookings`, `parking_slots`, `user_profiles`

3. Verify constraints:
```sql
SELECT conname, contype, conrelid::regclass
FROM pg_constraint
WHERE conrelid::regclass::text IN ('parking_slots', 'bookings');
```
- **Expected:**
  - `no_overlap` (exclude constraint on bookings)
  - `valid_time_range` (check constraint on bookings)
  - Foreign keys on all ID columns

4. Verify RLS enabled:
```sql
SELECT schemaname, tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public';
```
- **Expected:** `rowsecurity = true` for all 3 tables

5. Verify policies exist:
```sql
SELECT tablename, policyname
FROM pg_policies
WHERE schemaname = 'public'
ORDER BY tablename;
```
- **Expected:** 11 policies total (see schema lines 118-196)

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-D002: Booking Overlap Constraint
**Constraint:** `no_overlap` (schema line 84-88)

**Manual Test Steps:**

1. Create first booking:
```sql
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (
  1,
  (SELECT id FROM user_profiles LIMIT 1),
  '2025-10-08 09:00:00+00',
  '2025-10-08 17:00:00+00',
  400.00,
  'confirmed'
);
```
- **Expected:** Success (1 row inserted)

2. Attempt overlapping booking (same slot, overlapping time):
```sql
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (
  1,
  (SELECT id FROM user_profiles LIMIT 1),
  '2025-10-08 16:00:00+00',  -- Overlaps with 09:00-17:00
  '2025-10-08 18:00:00+00',
  100.00,
  'confirmed'
);
```
- **Expected:** Error: `conflicting key value violates exclusion constraint "no_overlap"`

3. Attempt non-overlapping booking (same slot, different time):
```sql
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (
  1,
  (SELECT id FROM user_profiles LIMIT 1),
  '2025-10-08 18:00:00+00',  -- Starts after 17:00
  '2025-10-08 20:00:00+00',
  100.00,
  'confirmed'
);
```
- **Expected:** Success (1 row inserted)

4. Verify cancelled bookings don't block:
```sql
-- Cancel first booking
UPDATE bookings SET status = 'cancelled' WHERE start_time = '2025-10-08 09:00:00+00';

-- Now can book the same time
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (
  1,
  (SELECT id FROM user_profiles LIMIT 1),
  '2025-10-08 09:00:00+00',
  '2025-10-08 17:00:00+00',
  400.00,
  'confirmed'
);
```
- **Expected:** Success (constraint excludes cancelled)

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-D003: Time Range Validation
**Constraint:** `valid_time_range` (schema line 81)

**Manual Test Steps:**

```sql
-- Test 1: Valid range (end > start)
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (1, (SELECT id FROM user_profiles LIMIT 1), NOW(), NOW() + INTERVAL '1 hour', 50.00, 'pending');
-- Expected: Success

-- Test 2: Invalid range (end = start)
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (1, (SELECT id FROM user_profiles LIMIT 1), NOW(), NOW(), 50.00, 'pending');
-- Expected: Error: check constraint "valid_time_range"

-- Test 3: Invalid range (end < start)
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (1, (SELECT id FROM user_profiles LIMIT 1), NOW(), NOW() - INTERVAL '1 hour', 50.00, 'pending');
-- Expected: Error: check constraint "valid_time_range"
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 5 minutes

---

#### TEST-D004: Price Validation
**Constraint:** `price_per_hour > 0` (schema line 44)

**Manual Test Steps:**

```sql
-- Test 1: Valid price
INSERT INTO parking_slots (owner_id, slot_number, price_per_hour, status)
VALUES ((SELECT id FROM user_profiles LIMIT 1), 'TEST-PRICE-1', 50.00, 'active');
-- Expected: Success

-- Test 2: Zero price
INSERT INTO parking_slots (owner_id, slot_number, price_per_hour, status)
VALUES ((SELECT id FROM user_profiles LIMIT 1), 'TEST-PRICE-2', 0, 'active');
-- Expected: Error: check constraint "price_per_hour > 0"

-- Test 3: Negative price
INSERT INTO parking_slots (owner_id, slot_number, price_per_hour, status)
VALUES ((SELECT id FROM user_profiles LIMIT 1), 'TEST-PRICE-3', -10.00, 'active');
-- Expected: Error: check constraint "price_per_hour > 0"
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 5 minutes

---

#### TEST-D005: RLS Policy - Public Read Slots
**Policy:** `public_read_slots` (schema line 147-149)

**Manual Test Steps:**

1. Create test slot as authenticated user:
```sql
-- As authenticated user
INSERT INTO parking_slots (owner_id, slot_number, price_per_hour, status)
VALUES (auth.uid(), 'RLS-TEST-1', 50.00, 'active');
```

2. Query as unauthenticated user (via anon key):
```sql
-- Use Supabase client with anon key
SELECT * FROM parking_slots WHERE slot_number = 'RLS-TEST-1';
```
- **Expected:** 1 row returned (public read allowed)

**Priority:** ðŸ”´ P0
**Estimated Time:** 5 minutes

---

#### TEST-D006: RLS Policy - Users See Own Bookings
**Policy:** `users_see_relevant_bookings` (schema line 169-177)

**Manual Test Steps:**

1. Create two test users (User A, User B)
2. User A creates slot
3. User B books User A's slot
4. As User A, query bookings:
```sql
SELECT * FROM bookings;
```
- **Expected:** See User B's booking (because User A owns the slot)

5. As User B, query bookings:
```sql
SELECT * FROM bookings;
```
- **Expected:** See own booking (because User B is the renter)

6. Create User C
7. As User C, query bookings:
```sql
SELECT * FROM bookings;
```
- **Expected:** No bookings visible (User C is neither renter nor owner)

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-D007: Cascade Delete
**Constraint:** `ON DELETE CASCADE` (schema lines 40, 66, 67)

**Manual Test Steps:**

1. Create test user with profile
2. User creates a slot
3. User creates a booking for someone else's slot
4. Delete the user:
```sql
-- This should cascade to user_profiles, parking_slots, bookings
DELETE FROM auth.users WHERE id = 'TEST_USER_ID';
```
5. Verify cascade:
```sql
-- Should be deleted
SELECT * FROM user_profiles WHERE id = 'TEST_USER_ID';
-- Expected: 0 rows

-- Should be deleted (slot owned by deleted user)
SELECT * FROM parking_slots WHERE owner_id = 'TEST_USER_ID';
-- Expected: 0 rows

-- Should be deleted (booking by deleted user)
SELECT * FROM bookings WHERE renter_id = 'TEST_USER_ID';
-- Expected: 0 rows
```

**Priority:** ðŸŸ¡ P1
**Estimated Time:** 10 minutes

---

#### TEST-D008: Helper Function - is_slot_bookable
**Function:** `is_slot_bookable` (schema lines 202-233)

**Manual Test Steps:**

```sql
-- Test 1: Available slot
SELECT is_slot_bookable(
  1,  -- slot_id
  NOW() + INTERVAL '1 day',
  NOW() + INTERVAL '1 day 2 hours'
);
-- Expected: true

-- Test 2: Slot with active booking (conflict)
-- First create a conflicting booking
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES (1, (SELECT id FROM user_profiles LIMIT 1),
        NOW() + INTERVAL '1 day',
        NOW() + INTERVAL '1 day 4 hours',
        200.00, 'confirmed');

-- Now test
SELECT is_slot_bookable(
  1,
  NOW() + INTERVAL '1 day 2 hours',  -- Overlaps with existing booking
  NOW() + INTERVAL '1 day 6 hours'
);
-- Expected: false

-- Test 3: Inactive slot
UPDATE parking_slots SET status = 'maintenance' WHERE slot_id = 1;

SELECT is_slot_bookable(1, NOW(), NOW() + INTERVAL '1 hour');
-- Expected: false

-- Test 4: Non-existent slot
SELECT is_slot_bookable(99999, NOW(), NOW() + INTERVAL '1 hour');
-- Expected: false
```

**Priority:** ðŸŸ¢ P2
**Estimated Time:** 10 minutes

---

## Authentication Flow Tests

### ðŸ”´ P0 - Critical Auth Tests

#### TEST-A001: AuthWrapper Component
**Component:** `components/auth/AuthWrapper.tsx`

**Manual Test Steps:**

**Scenario 1: Unauthenticated User**
1. Clear browser cookies/storage
2. Navigate to `/slots` (protected route)
3. **Expected:**
   - Brief loading spinner
   - Redirect to `/login`
   - "Redirecting to login..." message

**Scenario 2: Authenticated User with Profile**
1. Log in as test user
2. Navigate to `/slots`
3. **Expected:**
   - Loading spinner shows briefly
   - AuthWrapper fetches session
   - AuthWrapper fetches profile
   - Page content renders
   - Navigation shows user name

**Scenario 3: Authenticated User without Profile**
1. Create auth user in Supabase Auth (manually)
2. DO NOT create profile in user_profiles
3. Log in as that user
4. Navigate to `/slots`
5. **Expected:**
   - "Loading your profile..." message
   - Stays on loading (no redirect)
   - **Bug:** Should handle this gracefully

**Scenario 4: Token Refresh**
1. Log in as test user
2. Wait for 1 hour (or manually expire token)
3. **Expected:**
   - TOKEN_REFRESHED event fires
   - User stays logged in
   - No visible interruption

**Scenario 5: Logout in Another Tab**
1. Open app in Tab A (logged in)
2. Open app in Tab B (same user)
3. In Tab B, log out
4. Switch to Tab A
5. **Expected:**
   - SIGNED_OUT event fires in Tab A
   - Tab A redirects to `/login`
   - User sees "Redirecting to login..."

**Automated Test:**
```typescript
// __tests__/components/AuthWrapper.test.tsx
import { render, screen, waitFor } from '@testing-library/react'
import AuthWrapper, { useAuth } from '@/components/auth/AuthWrapper'

describe('AuthWrapper', () => {
  it('redirects to login when unauthenticated', async () => {
    const mockPush = jest.fn()
    jest.mock('next/navigation', () => ({ useRouter: () => ({ push: mockPush }) }))

    render(<AuthWrapper><div>Protected</div></AuthWrapper>)

    await waitFor(() => {
      expect(mockPush).toHaveBeenCalledWith('/login')
    })
  })

  it('renders children when authenticated', async () => {
    // Mock authenticated session
    // ... test implementation
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 20 minutes manual, 2 hours automated

---

#### TEST-A002: Login Flow End-to-End
**Components:** Login page, Supabase Auth, AuthWrapper

**Manual Test Steps:**

1. Start unauthenticated
2. Navigate to `/slots`
3. **Expected:** Redirect to `/login`
4. Enter valid credentials
5. Click "Login"
6. **Expected:**
   - `signInWithPassword()` succeeds
   - Session created in Supabase
   - Session cookie set in browser
   - Redirect to `/slots`
   - AuthWrapper fetches session
   - AuthWrapper fetches profile
   - Slots page renders
   - Navigation shows user name

**Verify Session Persistence:**
7. Refresh page
8. **Expected:**
   - No redirect to login
   - AuthWrapper reads session from cookie
   - User stays logged in

**Verify Session Across Tabs:**
9. Open new tab
10. Navigate to `/slots`
11. **Expected:**
    - Already logged in
    - No login required

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-A003: Registration Flow End-to-End
**Components:** Register page, Supabase Auth, Profile API

**Manual Test Steps:**

1. Navigate to `/register`
2. Fill form with new user data
3. Click "Sign Up"
4. **Expected Flow:**
   - Call `signUp({ email, password })`
   - Success â†’ Get user ID from response
   - Call `POST /api/profiles` with user ID
   - Profile created in database
   - Auto-login (signInWithPassword)
   - Redirect to `/slots`

**Verify in Database:**
```sql
-- Check auth.users
SELECT email FROM auth.users WHERE email = 'new.user@parkboard.com';

-- Check user_profiles
SELECT * FROM user_profiles WHERE email = 'new.user@parkboard.com';
```

**Test Rollback on Profile Failure:**
5. Modify `/api/profiles` to always fail
6. Register new user
7. **Expected:**
   - Auth user created
   - Profile creation fails
   - Error message shows
   - **Bug:** Auth user not rolled back (orphaned record)
   - **TODO:** Implement proper transaction

**Priority:** ðŸ”´ P0
**Estimated Time:** 15 minutes

---

## User Flow Tests

### ðŸ”´ P0 - Critical User Flows

#### TEST-UF001: Complete Booking Flow (Renter)
**Flow:** Browse â†’ Select Slot â†’ Book â†’ View Booking

**Manual Test Steps:**

**Setup:** Create test user A (owner) and user B (renter)

**As User A (Owner):**
1. Log in
2. Navigate to `/slots/new`
3. Create slot:
   - Slot Number: `FLOW-TEST-1`
   - Price: `50.00`
   - Description: `Test slot for booking flow`
4. Click "List Slot"
5. Verify redirect to `/slots`
6. Log out

**As User B (Renter):**
7. Log in
8. Navigate to `/slots`
9. Verify `FLOW-TEST-1` appears in list
10. Click on slot card
11. Verify redirect to `/slots/{slot_id}`
12. Fill booking form:
    - Start: Tomorrow 9:00 AM
    - End: Tomorrow 5:00 PM
13. Verify price calculates: 8 hours Ã— â‚±50 = â‚±400
14. Click "Confirm Booking"
15. Verify success message
16. Verify redirect to `/bookings`
17. Verify booking appears in list:
    - Slot: `FLOW-TEST-1`
    - Status: `PENDING`
    - Price: `â‚±400.00`
    - Owner: User A's name
18. Verify booking in database:
```sql
SELECT b.*, ps.slot_number, up.name as owner_name
FROM bookings b
JOIN parking_slots ps ON b.slot_id = ps.slot_id
JOIN user_profiles up ON ps.owner_id = up.id
WHERE b.renter_id = 'USER_B_ID'
ORDER BY b.created_at DESC LIMIT 1;
```

**As User A (Owner - Verify Visibility):**
19. Log in as User A
20. Navigate to `/bookings`
21. **Expected:** See User B's booking (RLS policy allows owner to see)
22. Verify owner contact info NOT shown (owner shouldn't see own contact)

**Priority:** ðŸ”´ P0
**Estimated Time:** 15 minutes
**Success Criteria:** Renter can find, book, and view slot. Owner can see booking.

---

#### TEST-UF002: Cancel Booking Flow
**Flow:** View Booking â†’ Cancel â†’ Verify Status

**Manual Test Steps:**

**Setup:** Create pending booking (from TEST-UF001)

1. Log in as renter
2. Navigate to `/bookings`
3. Find pending booking
4. Click "Cancel Booking"
5. Verify confirm dialog appears
6. Click "OK"
7. **Expected:**
   - Status badge changes to "CANCELLED" (red)
   - "Cancel Booking" button disappears
8. Refresh page
9. Verify booking still shows as cancelled
10. Verify in database:
```sql
SELECT status FROM bookings WHERE booking_id = X;
-- Expected: 'cancelled'
```

**Verify Slot Becomes Available:**
11. Navigate to `/slots`
12. Click on the slot that was booked
13. Try to book same time
14. **Expected:** Success (no overlap because booking cancelled)

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-UF003: Owner Listing Flow
**Flow:** Register â†’ List Slot â†’ See in Marketplace

**Manual Test Steps:**

1. Register new user (User C)
2. After registration, verify redirect to `/slots`
3. Click "List Your Slot" button
4. Verify redirect to `/slots/new`
5. Fill form:
   - Slot Number: `OWNER-TEST-1`
   - Type: `covered`
   - Description: `My first slot listing`
   - Price: `75.00`
6. Click "List Slot"
7. Verify redirect to `/slots`
8. Verify `OWNER-TEST-1` appears in list
9. Log out
10. Log in as different user
11. Navigate to `/slots`
12. Verify `OWNER-TEST-1` still visible (public marketplace)
13. Click on slot
14. Verify owner name shows as User C

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

### ðŸŸ¡ P1 - High Priority Flows

#### TEST-UF004: Multiple Bookings Same Slot
**Flow:** Book â†’ Book Different Time â†’ Verify Both Exist

**Manual Test Steps:**

1. Log in as User A
2. Book Slot 1: Tomorrow 9AM-5PM
3. Navigate back to `/slots/1`
4. Book Slot 1 again: Day after tomorrow 9AM-5PM
5. Navigate to `/bookings`
6. **Expected:** 2 bookings visible, both for Slot 1
7. Verify different dates

**Priority:** ðŸŸ¡ P1
**Estimated Time:** 5 minutes

---

#### TEST-UF005: Edit Own Slot (Not Implemented)
**Flow:** List Slot â†’ Edit Details â†’ Verify Updated

**Status:** âŒ Feature not implemented

**Test Steps (Future):**
1. Log in as owner
2. Navigate to "My Slots" page
3. Click "Edit" on own slot
4. Change price from â‚±50 to â‚±60
5. Save
6. Verify price updated in marketplace

**Priority:** ðŸŸ¢ P2 (future feature)

---

## Component Unit Tests

### ðŸ”´ P0 - Critical Components

#### TEST-C001: Navigation Component
**Component:** `components/common/Navigation.tsx`

**Unit Tests:**

```typescript
// __tests__/components/Navigation.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import Navigation from '@/components/common/Navigation'

jest.mock('@/components/auth/AuthWrapper', () => ({
  useAuth: () => ({
    profile: { name: 'John Doe', unit_number: '10A' }
  })
}))

describe('Navigation', () => {
  it('displays user name and unit', () => {
    render(<Navigation />)
    expect(screen.getByText('John Doe')).toBeInTheDocument()
    expect(screen.getByText(/unit 10a/i)).toBeInTheDocument()
  })

  it('renders navigation links', () => {
    render(<Navigation />)
    expect(screen.getByText('Browse Slots')).toHaveAttribute('href', '/slots')
    expect(screen.getByText('List My Slot')).toHaveAttribute('href', '/slots/new')
    expect(screen.getByText('My Bookings')).toHaveAttribute('href', '/bookings')
  })

  it('calls signOut on button click', async () => {
    const mockSignOut = jest.fn()
    jest.mock('@/lib/supabase/client', () => ({
      createClient: () => ({
        auth: { signOut: mockSignOut }
      })
    }))

    render(<Navigation />)
    fireEvent.click(screen.getByText('Sign Out'))

    expect(mockSignOut).toHaveBeenCalled()
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 1 hour

---

#### TEST-C002: AuthWrapper useAuth Hook
**Component:** `components/auth/AuthWrapper.tsx`

**Unit Tests:**

```typescript
// __tests__/components/useAuth.test.tsx
import { renderHook } from '@testing-library/react'
import { useAuth } from '@/components/auth/AuthWrapper'

describe('useAuth hook', () => {
  it('throws error when used outside AuthWrapper', () => {
    expect(() => {
      renderHook(() => useAuth())
    }).toThrow('useAuth must be used within AuthWrapper')
  })

  it('returns context when used inside AuthWrapper', () => {
    const wrapper = ({ children }) => (
      <AuthWrapper>{children}</AuthWrapper>
    )

    const { result } = renderHook(() => useAuth(), { wrapper })

    expect(result.current).toHaveProperty('user')
    expect(result.current).toHaveProperty('profile')
    expect(result.current).toHaveProperty('loading')
  })
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 30 minutes

---

### ðŸŸ¡ P1 - Important Components

#### TEST-C003: Button Component (shadcn/ui)
**Component:** `components/ui/button.tsx`

**Visual/Snapshot Tests:**

```typescript
describe('Button Component', () => {
  it('renders default variant', () => {
    const { container } = render(<Button>Click me</Button>)
    expect(container.firstChild).toMatchSnapshot()
  })

  it('renders outline variant', () => {
    const { container } = render(<Button variant="outline">Click me</Button>)
    expect(container.firstChild).toMatchSnapshot()
  })

  it('handles onClick', () => {
    const handleClick = jest.fn()
    render(<Button onClick={handleClick}>Click</Button>)
    fireEvent.click(screen.getByText('Click'))
    expect(handleClick).toHaveBeenCalled()
  })
})
```

**Priority:** ðŸŸ¡ P1
**Estimated Time:** 30 minutes

---

## Integration Tests

### ðŸ”´ P0 - Critical Integration Tests

#### TEST-I001: Login â†’ Browse â†’ Book Integration
**Components:** Login, AuthWrapper, Slots List, Slot Detail, Bookings

**Playwright E2E Test:**

```typescript
// tests/e2e/booking-flow.spec.ts
import { test, expect } from '@playwright/test'

test('complete booking flow', async ({ page }) => {
  // 1. Login
  await page.goto('http://localhost:3000/login')
  await page.fill('input[type="email"]', 'test@parkboard.com')
  await page.fill('input[type="password"]', 'TestPassword123!')
  await page.click('button[type="submit"]')

  // 2. Wait for redirect to /slots
  await expect(page).toHaveURL(/.*\/slots/)

  // 3. Verify slots displayed
  await expect(page.locator('text=Available Parking Slots')).toBeVisible()

  // 4. Click first slot
  await page.click('.slot-card:first-child')

  // 5. Fill booking form
  const tomorrow = new Date()
  tomorrow.setDate(tomorrow.getDate() + 1)
  const startTime = `${tomorrow.toISOString().split('T')[0]}T09:00`
  const endTime = `${tomorrow.toISOString().split('T')[0]}T17:00`

  await page.fill('input[type="datetime-local"]:first', startTime)
  await page.fill('input[type="datetime-local"]:last', endTime)

  // 6. Verify price calculation
  await expect(page.locator('text=/â‚±\\d+\\.\\d{2}/')).toBeVisible()

  // 7. Submit booking
  await page.click('button:has-text("Confirm Booking")')

  // 8. Verify success and redirect
  await expect(page).toHaveURL(/.*\/bookings/)
  await expect(page.locator('text=Booking #')).toBeVisible()
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 2 hours

---

#### TEST-I002: Register â†’ Create Slot â†’ See in Marketplace
**Playwright E2E Test:**

```typescript
test('register and create slot', async ({ page }) => {
  // 1. Register
  await page.goto('http://localhost:3000/register')

  const randomEmail = `test${Date.now()}@parkboard.com`

  await page.fill('input[name="name"]', 'Test User')
  await page.fill('input[type="email"]', randomEmail)
  await page.fill('input[type="password"]', 'TestPassword123!')
  await page.fill('input[name="phone"]', '+639171234567')
  await page.fill('input[name="unit_number"]', '99Z')
  await page.click('button[type="submit"]')

  // 2. Auto-login and redirect to /slots
  await expect(page).toHaveURL(/.*\/slots/)

  // 3. Create slot
  await page.click('text=List Your Slot')
  await expect(page).toHaveURL(/.*\/slots\/new/)

  await page.fill('input[name="slot_number"]', 'E2E-TEST-1')
  await page.selectOption('select[name="slot_type"]', 'covered')
  await page.fill('textarea[name="description"]', 'E2E test slot')
  await page.fill('input[name="price_per_hour"]', '50')
  await page.click('button:has-text("List Slot")')

  // 4. Verify redirect and slot visible
  await expect(page).toHaveURL(/.*\/slots$/)
  await expect(page.locator('text=E2E-TEST-1')).toBeVisible()
})
```

**Priority:** ðŸ”´ P0
**Estimated Time:** 2 hours

---

## Performance Tests

### ðŸŸ¢ P2 - Performance Benchmarks

#### TEST-P001: Slots List Load Time
**Target:** < 1 second for 100 slots

**Manual Test:**

1. Seed database with 100 slots:
```sql
INSERT INTO parking_slots (owner_id, slot_number, price_per_hour, status)
SELECT
  (SELECT id FROM user_profiles LIMIT 1),
  'PERF-' || generate_series,
  50.00,
  'active'
FROM generate_series(1, 100);
```

2. Clear browser cache
3. Open DevTools â†’ Network tab
4. Navigate to `/slots`
5. Measure "Load" time
6. **Expected:** < 1000ms

**Automated Test:**
```typescript
import { performance } from 'perf_hooks'

test('slots list performance', async () => {
  const start = performance.now()

  const response = await fetch('http://localhost:3000/slots')
  await response.text()

  const end = performance.now()
  const duration = end - start

  expect(duration).toBeLessThan(1000)
})
```

**Priority:** ðŸŸ¢ P2
**Estimated Time:** 30 minutes

---

## Security Tests

### ðŸ”´ P0 - Critical Security Tests

#### TEST-S001: RLS Enforcement
**Test:** User cannot access another user's bookings via direct SQL

**Manual Test:**

1. Create User A and User B
2. User A creates booking
3. As User B, attempt to query User A's booking:
```sql
-- This should return 0 rows due to RLS
SELECT * FROM bookings WHERE renter_id = 'USER_A_ID';
```
- **Expected:** 0 rows (RLS blocks)

4. As User B, attempt to update User A's booking:
```sql
UPDATE bookings SET status = 'cancelled' WHERE renter_id = 'USER_A_ID';
```
- **Expected:** 0 rows updated (RLS blocks)

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-S002: SQL Injection Protection
**Test:** Supabase client prevents SQL injection

**Manual Test:**

1. Attempt SQL injection in slot number search:
```typescript
const slotNumber = "'; DROP TABLE parking_slots; --"

const { data } = await supabase
  .from('parking_slots')
  .select('*')
  .eq('slot_number', slotNumber)
```
- **Expected:** No error, 0 results (parameterized query prevents injection)

2. Verify table still exists:
```sql
SELECT COUNT(*) FROM parking_slots;
```
- **Expected:** Table intact

**Priority:** ðŸ”´ P0
**Estimated Time:** 10 minutes

---

#### TEST-S003: XSS Protection
**Test:** User input sanitized in UI

**Manual Test:**

1. Create slot with malicious description:
```
Description: <script>alert('XSS')</script>
```
2. Save slot
3. Navigate to `/slots`
4. **Expected:** Script tag rendered as text, NOT executed
5. Inspect HTML â†’ Verify `<script>` escaped as `&lt;script&gt;`

**Priority:** ðŸ”´ P0
**Estimated Time:** 5 minutes

---

## Test Execution Checklist

### Pre-Deployment Test Run

**ðŸ”´ P0 Tests (MUST PASS):**
- [ ] TEST-R001: Landing Page
- [ ] TEST-R002: Login Page
- [ ] TEST-R003: Register Page
- [ ] TEST-R004: Browse Slots
- [ ] TEST-R005: Slot Detail & Booking
- [ ] TEST-R006: My Bookings
- [ ] TEST-R007: New Slot Listing
- [ ] TEST-D001: Schema Creation
- [ ] TEST-D002: Booking Overlap Constraint
- [ ] TEST-D003: Time Range Validation
- [ ] TEST-D004: Price Validation
- [ ] TEST-D005: RLS Public Read
- [ ] TEST-D006: RLS Own Bookings
- [ ] TEST-A001: AuthWrapper
- [ ] TEST-A002: Login Flow
- [ ] TEST-A003: Registration Flow
- [ ] TEST-UF001: Complete Booking Flow
- [ ] TEST-UF002: Cancel Booking
- [ ] TEST-UF003: Owner Listing
- [ ] TEST-S001: RLS Enforcement
- [ ] TEST-S002: SQL Injection
- [ ] TEST-S003: XSS Protection

**ðŸŸ¡ P1 Tests (SHOULD PASS):**
- [ ] TEST-R008: Profile API
- [ ] TEST-D007: Cascade Delete
- [ ] TEST-UF004: Multiple Bookings

**ðŸŸ¢ P2 Tests (NICE TO PASS):**
- [ ] TEST-D008: Helper Function
- [ ] TEST-P001: Performance

---

## Test Data Setup Scripts

### Script 1: Create Test Users

```sql
-- Create 3 test users (run after creating auth users manually)
INSERT INTO user_profiles (id, name, email, phone, unit_number)
VALUES
  ('USER_A_UUID', 'Alice Owner', 'alice@test.com', '+639171111111', '10A'),
  ('USER_B_UUID', 'Bob Renter', 'bob@test.com', '+639172222222', '20B'),
  ('USER_C_UUID', 'Charlie Admin', 'charlie@test.com', '+639173333333', '30C');
```

### Script 2: Create Test Slots

```sql
INSERT INTO parking_slots (owner_id, slot_number, slot_type, price_per_hour, description, status)
VALUES
  ('USER_A_UUID', 'A-10', 'covered', 50.00, 'Near elevator, well-lit', 'active'),
  ('USER_A_UUID', 'A-11', 'covered', 45.00, 'Corner spot', 'active'),
  ('USER_C_UUID', 'B-05', 'uncovered', 30.00, 'Open air parking', 'active');
```

### Script 3: Create Test Bookings

```sql
INSERT INTO bookings (slot_id, renter_id, start_time, end_time, total_price, status)
VALUES
  (1, 'USER_B_UUID', NOW() + INTERVAL '1 day', NOW() + INTERVAL '1 day 8 hours', 400.00, 'pending'),
  (2, 'USER_B_UUID', NOW() + INTERVAL '2 days', NOW() + INTERVAL '2 days 4 hours', 180.00, 'confirmed');
```

### Script 4: Cleanup Test Data

```sql
DELETE FROM bookings WHERE total_price < 1000;  -- Remove test bookings
DELETE FROM parking_slots WHERE slot_number LIKE 'TEST-%' OR slot_number LIKE 'E2E-%';
DELETE FROM user_profiles WHERE email LIKE '%@test.com';
```

---

## Test Coverage Report Template

```
ParkBoard Test Coverage Report
Generated: [DATE]

Route Tests:        X / 8  (X%)
Database Tests:     X / 8  (X%)
Auth Tests:         X / 3  (X%)
User Flow Tests:    X / 5  (X%)
Component Tests:    X / 3  (X%)
Integration Tests:  X / 2  (X%)
Security Tests:     X / 3  (X%)

Overall:            X / 32 (X%)

P0 Critical:        X / 23 (X%)  â† MUST BE 100%
P1 High:            X / 6  (X%)  â† TARGET 90%+
P2 Medium:          X / 3  (X%)  â† TARGET 70%+

Status: [PASS/FAIL]
Blocking Issues: [LIST]
```

---

## Conclusion

This test suite provides comprehensive coverage of:
- **32 test scenarios** across all critical paths
- **Route testing** for all 8 pages
- **Database constraints** and RLS policies
- **User flows** from registration to booking
- **Security validation** against common vulnerabilities

### Next Steps

1. **Week 1:** Implement P0 automated tests (23 tests)
2. **Week 2:** Run full manual test suite, fix bugs
3. **Week 3:** Implement P1 automated tests (6 tests)
4. **Week 4:** CI/CD integration with test automation

### Success Criteria for MVP Launch

- âœ… All P0 tests pass (100%)
- âœ… All P1 tests pass (90%+)
- âœ… No critical security vulnerabilities
- âœ… Performance < 2s for all routes
- âœ… E2E booking flow works end-to-end

---

**Document Version:** 1.0
**Last Updated:** 2025-10-07
**Total Test Count:** 32 scenarios
**Estimated Execution Time:** 4 hours manual, 20 hours automated
